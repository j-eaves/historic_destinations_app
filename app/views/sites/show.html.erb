<body>
<!-- <hr> -->
<!-- <h4>Sites from my API</h4> -->
<div id="app">
  <!-- {{ sites }} -->
<!-- 	<div v-for="site in sites">
	  	<p> Name of historic site: {{ site.name }} </p>
	  	<p> Latitude: {{ site.latitude }} </p>
	  	<p> Longitude: {{ site.longitude }} </p>
	  	<hr>
	</div> -->
</div>

<div id="map"></div>
<script>
	function initMap() {
		//----------------------------------------------------------------
		//get my user input center point latitude from the sites_controller
		//var searchLocation = "<%= @address %>";
		var latitude = parseFloat("<%= @lat %>");
	    console.log(latitude)
	    //get my center point latitude from the sites_controller
	    var longitude = parseFloat("<%= @lng %>");
	    console.log(longitude)
	    //create a JS hash with the latitude and longitude
	    var latLng = {lat: latitude, lng: longitude};

	  	var centerPointPin = {name: "Your Location: <%= @address %>", latitude: latitude, longitude: longitude};
	  	//----------------------------------------------------------------
	    //declare the createMarker function (this was at the bottom)
		function createMarker(location){
			console.log(location);
		    var infowindow = new google.maps.InfoWindow({
		      content: "<p>"+location.name+"</p><p>"+location.description+"</p>"
		    });
		    
		    // Create a marker and set its position.
		    var marker = new google.maps.Marker({
		      position: {lat: location.latitude, lng: location.longitude},
		      map: map, 
		      // title: location.name
		      title: location
		    });
		    
		    marker.addListener('click', function() {
		      infowindow.open(map, marker);
		    });
		  }

		//grab the historical sites from my tables via my api
		$.get("/api/v1/sites", function(response) {
			console.log('This is the $.get /api/v1/sites function')
			console.log(response);
			console.log(this);
			// this.sites = response;
			var historicalSites = response;
			console.log(historicalSites);
			//create an array and fill it with all of the historicalSites
			for (var i = 0; i < historicalSites.length; i++) {
			  //call the function 
			  createMarker(historicalSites[i]);
			}
		}.bind(this));
		//grab the historical houses from my tables via my api
		$.get("/api/v1/houses", function(response) {
			console.log('This is the $.get /api/v1/houses function')
			console.log(response);
			console.log(this);
			// this.sites = response;
			var nycHistoricSites = response;
			console.log(nycHistoricSites);
			//create an array and fill it with all of the nycHistoricSites
			for (var i = 0; i < nycHistoricSites.length; i++) {
			  //call the function 
			  createMarker(nycHistoricSites[i]);
			}
		}.bind(this));

		//use my latitude and longitude hash in the map function to set center
	    var map = new google.maps.Map(document.getElementById('map'), {
	      center: latLng,
	      scrollwheel: false,
	      zoom: 11,
	      styles: [
			    {
			        "featureType": "all",
			        "elementType": "geometry",
			        "stylers": [
			            {
			                "color": "#ffffff"
			            }
			        ]
			    },
			    {
			        "featureType": "all",
			        "elementType": "labels.text.fill",
			        "stylers": [
			            {
			                "gamma": 0.01
			            },
			            {
			                "lightness": 20
			            }
			        ]
			    },
			    {
			        "featureType": "all",
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "saturation": -31
			            },
			            {
			                "lightness": -33
			            },
			            {
			                "weight": 2
			            },
			            {
			                "gamma": 0.8
			            }
			        ]
			    },
			    {
			        "featureType": "all",
			        "elementType": "labels.icon",
			        "stylers": [
			            {
			                "visibility": "off"
			            }
			        ]
			    },
			    {
			        "featureType": "administrative.locality",
			        "elementType": "labels.text.fill",
			        "stylers": [
			            {
			                "color": "#050505"
			            }
			        ]
			    },
			    {
			        "featureType": "administrative.locality",
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "color": "#fef3f3"
			            },
			            {
			                "weight": "3.01"
			            }
			        ]
			    },
			    {
			        "featureType": "administrative.neighborhood",
			        "elementType": "labels.text.fill",
			        "stylers": [
			            {
			                "color": "#0a0a0a"
			            },
			            {
			                "visibility": "off"
			            }
			        ]
			    },
			    {
			        "featureType": "administrative.neighborhood",
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "color": "#fffbfb"
			            },
			            {
			                "weight": "3.01"
			            },
			            {
			                "visibility": "off"
			            }
			        ]
			    },
			    {
			        "featureType": "landscape",
			        "elementType": "geometry",
			        "stylers": [
			            {
			                "lightness": 30
			            },
			            {
			                "saturation": 30
			            }
			        ]
			    },
			    {
			        "featureType": "poi",
			        "elementType": "geometry",
			        "stylers": [
			            {
			                "saturation": 20
			            }
			        ]
			    },
			    {
			        "featureType": "poi.attraction",
			        "elementType": "labels.icon",
			        "stylers": [
			            {
			                "visibility": "off"
			            }
			        ]
			    },
			    {
			        "featureType": "poi.park",
			        "elementType": "geometry",
			        "stylers": [
			            {
			                "lightness": 20
			            },
			            {
			                "saturation": -20
			            }
			        ]
			    },
			    {
			        "featureType": "road",
			        "elementType": "geometry",
			        "stylers": [
			            {
			                "lightness": 10
			            },
			            {
			                "saturation": -30
			            }
			        ]
			    },
			    {
			        "featureType": "road",
			        "elementType": "geometry.stroke",
			        "stylers": [
			            {
			                "saturation": 25
			            },
			            {
			                "lightness": 25
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "visibility": "on"
			            },
			            {
			                "color": "#a1a1a1"
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway",
			        "elementType": "geometry.stroke",
			        "stylers": [
			            {
			                "color": "#292929"
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway",
			        "elementType": "labels.text.fill",
			        "stylers": [
			            {
			                "visibility": "on"
			            },
			            {
			                "color": "#202020"
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway",
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "visibility": "on"
			            },
			            {
			                "color": "#ffffff"
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway",
			        "elementType": "labels.icon",
			        "stylers": [
			            {
			                "visibility": "simplified"
			            },
			            {
			                "hue": "#0006ff"
			            },
			            {
			                "saturation": "-100"
			            },
			            {
			                "lightness": "13"
			            },
			            {
			                "gamma": "0.00"
			            }
			        ]
			    },
			    {
			        "featureType": "road.arterial",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "visibility": "on"
			            },
			            {
			                "color": "#686868"
			            }
			        ]
			    },
			    {
			        "featureType": "road.arterial",
			        "elementType": "geometry.stroke",
			        "stylers": [
			            {
			                "visibility": "off"
			            },
			            {
			                "color": "#8d8d8d"
			            }
			        ]
			    },
			    {
			        "featureType": "road.arterial",
			        "elementType": "labels.text.fill",
			        "stylers": [
			            {
			                "visibility": "on"
			            },
			            {
			                "color": "#353535"
			            },
			            {
			                "lightness": "6"
			            }
			        ]
			    },
			    {
			        "featureType": "road.arterial",
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "visibility": "on"
			            },
			            {
			                "color": "#ffffff"
			            },
			            {
			                "weight": "3.45"
			            }
			        ]
			    },
			    {
			        "featureType": "road.local",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "color": "#d0d0d0"
			            }
			        ]
			    },
			    {
			        "featureType": "road.local",
			        "elementType": "geometry.stroke",
			        "stylers": [
			            {
			                "lightness": "2"
			            },
			            {
			                "visibility": "on"
			            },
			            {
			                "color": "#999898"
			            }
			        ]
			    },
			    {
			        "featureType": "road.local",
			        "elementType": "labels.text.fill",
			        "stylers": [
			            {
			                "color": "#383838"
			            }
			        ]
			    },
			    {
			        "featureType": "road.local",
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "color": "#faf8f8"
			            }
			        ]
			    },
			    {
			        "featureType": "water",
			        "elementType": "all",
			        "stylers": [
			            {
			                "lightness": -20
			            }
			        ]
			    }
			]
	    });

	    createMarker(centerPointPin);
	  // Create a map object and specify the DOM element for display.

	  //the commented section below may be used at a later date
	  // var coordinates = {};

	  // $.get("/api/v1/center_point", function(response) {
	  //   coordinates = response;
	  //   console.log("inside coordinates function")
	  //   console.log(coordinates.lat);
	  //   console.log(coordinates.lng);

	  //   var latLng = {lat: coordinates.lat, lng: coordinates.lng};

	  //   var map = new google.maps.Map(document.getElementById('map'), {
	  //     center: latLng,
	  //     scrollwheel: false,
	  //     zoom: 10
	  //   });
	  // });
	}
</script>
<!-- My map link with my key is next -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUva3q8K4CQFTUX7WqQXJXY5xV95OhmNU&callback=initMap"
async defer></script>
<div id="form">
	<%= form_tag '/', method: :get do  %>
	  	<input type="submit" value="New Search">
	<% end %>
</div>
</body>

