<body>
<!-- <hr> -->
<!-- <h4>Sites from my API</h4> -->
<div id="app">
  <!-- {{ sites }} -->
<!-- 	<div v-for="site in sites">
	  	<p> Name of historic site: {{ site.name }} </p>
	  	<p> Latitude: {{ site.latitude }} </p>
	  	<p> Longitude: {{ site.longitude }} </p>
	  	<hr>
	</div> -->
</div>

<div id="map"></div>
<script>
	function initMap() {
		//----------------------------------------------------------------
		//get my user input center point latitude from the sites_controller
		//var searchLocation = "<%= @address %>";
		var latitude = parseFloat("<%= @lat %>");
	    console.log(latitude)
	    //get my center point latitude from the sites_controller
	    var longitude = parseFloat("<%= @lng %>");
	    console.log(longitude)
	    //create a JS hash with the latitude and longitude
	    var latLng = {lat: latitude, lng: longitude};

	  	var centerPointPin = {name: "Your Location: <%= @address %>", latitude: latitude, longitude: longitude};
	  	//----------------------------------------------------------------
	    //declare the createMarker function (this was at the bottom)
		function createMarker(location){
		    var infowindow = new google.maps.InfoWindow({
		      // content: location.description
		      content: location.name
		    });
		    
		    // Create a marker and set its position.
		    var marker = new google.maps.Marker({
		      position: {lat: location.latitude, lng: location.longitude},
		      map: map, 
		      // title: location.name
		      title: location
		    });
		    
		    marker.addListener('click', function() {
		      infowindow.open(map, marker);
		    });
		  }

		//grab the historical sites from my tables via my apis
		$.get("/api/v1/sites", function(response) {
			console.log('This is the $.get /api/v1/sites function')
			console.log(response);
			console.log(this);
			// this.sites = response;
			var historicalSites = response;
			console.log(historicalSites);
			//create an array and fill it with all of the historicalSites
			for (var i = 0; i < historicalSites.length; i++) {
			  //call the function 
			  createMarker(historicalSites[i]);
			}
		}.bind(this));

		$.get("/api/v1/houses", function(response) {
			console.log('This is the $.get /api/v1/houses function')
			console.log(response);
			console.log(this);
			// this.sites = response;
			var nycHistoricSites = response;
			console.log(nycHistoricSites);
			//create an array and fill it with all of the historicalSites
			for (var i = 0; i < nycHistoricSites.length; i++) {
			  //call the function 
			  createMarker(nycHistoricSites[i]);
			}
		}.bind(this));

		//use my latitude and longitude hash in the map function to set center
	    var map = new google.maps.Map(document.getElementById('map'), {
	      center: latLng,
	      scrollwheel: false,
	      zoom: 13,
	      styles: [
			    {
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "color": "#ffffff"
			            }
			        ]
			    },
			    {
			        "elementType": "labels.text.fill",
			        "stylers": [
			            {
			                "color": "#000000"
			            }
			        ]
			    },
			    {
			        "featureType": "water",
			        "elementType": "geometry",
			        "stylers": [
			            {
			                "color": "#0000ff"
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "color": "#ff0000"
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway",
			        "elementType": "geometry.stroke",
			        "stylers": [
			            {
			                "color": "#000100"
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway.controlled_access",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "color": "#ffff00"
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway.controlled_access",
			        "elementType": "geometry.stroke",
			        "stylers": [
			            {
			                "color": "#ff0000"
			            }
			        ]
			    },
			    {
			        "featureType": "road.arterial",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "color": "#ffa91a"
			            }
			        ]
			    },
			    {
			        "featureType": "road.arterial",
			        "elementType": "geometry.stroke",
			        "stylers": [
			            {
			                "color": "#000000"
			            }
			        ]
			    },
			    {
			        "featureType": "landscape.natural",
			        "stylers": [
			            {
			                "saturation": 36
			            },
			            {
			                "gamma": 0.55
			            }
			        ]
			    },
			    {
			        "featureType": "road.local",
			        "elementType": "geometry.stroke",
			        "stylers": [
			            {
			                "color": "#000000"
			            }
			        ]
			    },
			    {
			        "featureType": "road.local",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "color": "#ffffff"
			            }
			        ]
			    },
			    {
			        "featureType": "landscape.man_made",
			        "elementType": "geometry.stroke",
			        "stylers": [
			            {
			                "lightness": -100
			            },
			            {
			                "weight": 2.1
			            }
			        ]
			    },
			    {
			        "featureType": "landscape.man_made",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "invert_lightness": true
			            },
			            {
			                "hue": "#ff0000"
			            },
			            {
			                "gamma": 3.02
			            },
			            {
			                "lightness": 20
			            },
			            {
			                "saturation": 40
			            }
			        ]
			    },
			    {
			        "featureType": "poi.attraction",
			        "stylers": [
			            {
			                "saturation": 100
			            },
			            {
			                "hue": "#ff00ee"
			            },
			            {
			                "lightness": -13
			            }
			        ]
			    },
			    {
			        "featureType": "poi.government",
			        "stylers": [
			            {
			                "saturation": 100
			            },
			            {
			                "hue": "#eeff00"
			            },
			            {
			                "gamma": 0.67
			            },
			            {
			                "lightness": -26
			            }
			        ]
			    },
			    {
			        "featureType": "poi.medical",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "hue": "#ff0000"
			            },
			            {
			                "saturation": 100
			            },
			            {
			                "lightness": -37
			            }
			        ]
			    },
			    {
			        "featureType": "poi.medical",
			        "elementType": "labels.text.fill",
			        "stylers": [
			            {
			                "color": "#ff0000"
			            }
			        ]
			    },
			    {
			        "featureType": "poi.school",
			        "stylers": [
			            {
			                "hue": "#ff7700"
			            },
			            {
			                "saturation": 97
			            },
			            {
			                "lightness": -41
			            }
			        ]
			    },
			    {
			        "featureType": "poi.sports_complex",
			        "stylers": [
			            {
			                "saturation": 100
			            },
			            {
			                "hue": "#00ffb3"
			            },
			            {
			                "lightness": -71
			            }
			        ]
			    },
			    {
			        "featureType": "poi.park",
			        "stylers": [
			            {
			                "saturation": 84
			            },
			            {
			                "lightness": -57
			            },
			            {
			                "hue": "#a1ff00"
			            }
			        ]
			    },
			    {
			        "featureType": "transit.station.airport",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "gamma": 0.11
			            }
			        ]
			    },
			    {
			        "featureType": "transit.station",
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "color": "#ffc35e"
			            }
			        ]
			    },
			    {
			        "featureType": "transit.line",
			        "elementType": "geometry",
			        "stylers": [
			            {
			                "lightness": -100
			            }
			        ]
			    },
			    {
			        "featureType": "administrative",
			        "stylers": [
			            {
			                "saturation": 100
			            },
			            {
			                "gamma": 0.35
			            },
			            {
			                "lightness": 20
			            }
			        ]
			    },
			    {
			        "featureType": "poi.business",
			        "elementType": "geometry.fill",
			        "stylers": [
			            {
			                "saturation": -100
			            },
			            {
			                "gamma": 0.35
			            }
			        ]
			    },
			    {
			        "featureType": "poi.business",
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "color": "#69ffff"
			            }
			        ]
			    },
			    {
			        "featureType": "poi.place_of_worship",
			        "elementType": "labels.text.stroke",
			        "stylers": [
			            {
			                "color": "#c3ffc3"
			            }
			        ]
			    }
			]
	    });

	    createMarker(centerPointPin);
	  // Create a map object and specify the DOM element for display.

	  //the commented section below may be used at a later date
	  // var coordinates = {};

	  // $.get("/api/v1/center_point", function(response) {
	  //   coordinates = response;
	  //   console.log("inside coordinates function")
	  //   console.log(coordinates.lat);
	  //   console.log(coordinates.lng);

	  //   var latLng = {lat: coordinates.lat, lng: coordinates.lng};

	  //   var map = new google.maps.Map(document.getElementById('map'), {
	  //     center: latLng,
	  //     scrollwheel: false,
	  //     zoom: 10
	  //   });
	  // });
	}
</script>
<!-- My map link with my key is next -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUva3q8K4CQFTUX7WqQXJXY5xV95OhmNU&callback=initMap"
async defer></script>
<div id="form">
	<%= form_tag '/', method: :get do  %>
	  	<input type="submit" value="New Search">
	<% end %>
</div>
</body>

