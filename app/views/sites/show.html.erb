<body>
<hr>
<h4>Sites from my API</h4>
<div id="app">
  <!-- {{ sites }} -->
	<div v-for="site in sites">
	  	<p> Name of historic site: {{ site.name }} </p>
	  	<p> Latitude: {{ site.latitude }} </p>
	  	<p> Longitude: {{ site.longitude }} </p>
	  	<hr>
	</div>
	{{ coordinates }}
 
<!--   {{ coordinates.lat }}
  {{ coordinates.lng }}  -->
</div>

<div id="map"></div>
<script>
	function initMap() {

		//get my user input center point latitude from the sites_controller
		var latitude = parseFloat("<%= @lat %>");
	    console.log(latitude)
	    //get my center point latitude from the sites_controller
	    var longitude = parseFloat("<%= @lng %>");
	    console.log(longitude)
	    //create a JS hash with the latitude and longitude
	    var latLng = {lat: latitude, lng: longitude};

	    //declare the createMarker function (this was at the bottom)
		function createMarker(location){
		    var infowindow = new google.maps.InfoWindow({
		      // content: location.description
		      content: location.name
		    });
		    
		    // Create a marker and set its position.
		    var marker = new google.maps.Marker({
		      position: {lat: location.latitude, lng: location.longitude},
		      map: map, 
		      title: location.name
		    });
		    marker.addListener('click', function() {
		      infowindow.open(map, marker);
		    });
		  }

		//grab the historical sites from my db via my api
		$.get("/api/v1/sites", function(response) {
			console.log('This is the $.get /api/v1/sites function')
			console.log(response);
			console.log(this);
			// this.sites = response;
			var historicalSites = response;
			console.log(historicalSites);
			//create an array and fill it with all of the historicalSites
			for (var i = 0; i < historicalSites.length; i++) {
			  //call the function 
			  createMarker(historicalSites[i]);
			}
		}.bind(this));

		//use my latitude and longitude hash in the map function to set center
	    var map = new google.maps.Map(document.getElementById('map'), {
	      center: latLng,
	      scrollwheel: false,
	      zoom: 10
	    });

	  // Create a map object and specify the DOM element for display.

	  //the commented section below may be used at a later date
	  // var coordinates = {};

	  // $.get("/api/v1/center_point", function(response) {
	  //   coordinates = response;
	  //   console.log("inside coordinates function")
	  //   console.log(coordinates.lat);
	  //   console.log(coordinates.lng);

	  //   var latLng = {lat: coordinates.lat, lng: coordinates.lng};

	  //   var map = new google.maps.Map(document.getElementById('map'), {
	  //     center: latLng,
	  //     scrollwheel: false,
	  //     zoom: 10
	  //   });
	  // });
	}
</script>
<!-- My map link with my key is next -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBUva3q8K4CQFTUX7WqQXJXY5xV95OhmNU&callback=initMap"
async defer></script>
</body>

