<body>
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div>

     <%= form_tag "/sites", method: :post, class: "navbar-form navbar-left" do %>
        <div id="app" class="form-group">
	          <p><input type="text" class="form-control" placeholder="Enter Next Destination" name="search_address">
	          <button type="submit" class="btn btn-primary">Submit</button></p>
        </div>
      <% end %>
      
    </div>
  </div>
</nav>  

<!-- Start Test -->
<!-- <h1>Popup/Modal Windows without JavaScript</h1> -->
<!-- <div class="box">
	<a class="button" href="#popup1">Let me Pop up</a>
</div> -->

<!-- <div id="popup1" class="overlay"> -->
	<!-- <div class="popup"> -->
		<!-- <h2>Here i am</h2> -->
		<!-- <a class="close" href="#">Ã—</a> -->
		<!-- <div class="content">
			Thanks for pop me out of that button, but now i'm done so you can close this window.
		</div> -->
	<!-- </div> -->
<!-- </div> -->
<!-- End Test -->


<div id="app">
  <!-- {{ sites }}
	<div v-for="site in sites">
	  	<p> Name of historic site: {{ site.name }} </p>
	  	<hr>
	</div> -->
</div>

<!-- The map_canvas id from http://stackoverflow.com/questions/38569860/close-all-other-infowindows-when-one-is-clicked -->
<script src="https://maps.googleapis.com/maps/api/js"></script>
<div id="map_canvas"></div>
<script>
	//from: http://jsfiddle.net/geocodezip/7de0z99e/2/
	//Modify the code between the double lines to work woth your working code
	var geocoder;
	var map;
	var historicalSites = [];//declare this variable outside of the $.Get function
	var nycHistoricSites = [];//declare this variable outside of the $.Get function
	var latitude = parseFloat("<%= @lat %>");//mine
	var longitude = parseFloat("<%= @lng %>");//mine
	var centerPointPin = {name: "Your Location: <%= @address %>", latitude: latitude, longitude: longitude};//mine

	function initialize() {
	  
	  var map = new google.maps.Map(
	    document.getElementById("map_canvas"), {
	      center: new google.maps.LatLng(latitude, longitude), //changed by me
	      zoom: 12,
	      //mapTypeId: google.maps.MapTypeId.ROADMAP //I may not need this
          styles: [
			    {
			        "featureType": "landscape",
			        "stylers": [
			            {
			                "saturation": -7
			            },
			            {
			                "gamma": 1.02
			            },
			            {
			                "hue": "#ffc300"
			            },
			            {
			                "lightness": -10
			            }
			        ]
			    },
			    {
			        "featureType": "road.highway",
			        "stylers": [
			            {
			                "hue": "#ffaa00"
			            },
			            {
			                "saturation": -45
			            },
			            {
			                "gamma": 1
			            },
			            {
			                "lightness": -4
			            }
			        ]
			    },
			    {
			        "featureType": "road.arterial",
			        "stylers": [
			            {
			                "hue": "#ffaa00"
			            },
			            {
			                "lightness": -10
			            },
			            {
			                "saturation": 64
			            },
			            {
			                "gamma": 0.9
			            }
			        ]
			    },
			    {
			        "featureType": "road.local",
			        "stylers": [
			            {
			                "lightness": -5
			            },
			            {
			                "hue": "#00f6ff"
			            },
			            {
			                "saturation": -40
			            },
			            {
			                "gamma": 0.75
			            }
			        ]
			    },
			    {
			        "featureType": "poi",
			        "stylers": [
			            {
			                "saturation": -30
			            },
			            {
			                "lightness": 11
			            },
			            {
			                "gamma": 0.5
			            },
			            {
			                "hue": "#ff8000"
			            }
			        ]
			    },
			    {
			        "featureType": "water",
			        "stylers": [
			            {
			                "hue": "#0077ff"
			            },
			            {
			                "gamma": 1.25
			            },
			            {
			                "saturation": -22
			            },
			            {
			                "lightness": -31
			            }
			        ]
			    }
			],
			scaleControl: true
	  });

	  function createMarker(location){
		    // Create a marker and set its position.
		    var markerTest = new google.maps.Marker({
		      position: {lat: location.latitude, lng: location.longitude},
		      map: map, 
		      title: location.name
		    });
		    infoWindow(markerTest, map, location);
	  }

	  function createCenterMarker(location){
	
		    var pinImage = new google.maps.MarkerImage("http://www.googlemapsmarkers.com/v1/009900/");
		    // Create a marker and set its position.
		    var marker1 = new google.maps.Marker({
		      position: {lat: location.latitude, lng: location.longitude},
		      title: location.name,
		      icon: pinImage,
		      map: map
		    });
		    infoWindow(marker1, map, location);
	  };

	  createCenterMarker(centerPointPin);

	  //grab the (state) historical sites from my tables via my api
	  $.get("/api/v1/sites", function(response) {
	  	  //console.log('This is the $.get /api/v1/sites function')
	  	  historicalSites = response;
		  //create an array and fill it with all of the historicalSites
		  for (var i = 0; i < historicalSites.length; i++) {
		    //call the function 
		    createMarker(historicalSites[i]);
		  }
	  }.bind(this));

		//grab the historical houses from my tables via my api
	  $.get("/api/v1/houses", function(response) {
		  //console.log('This is the $.get /api/v1/houses function')
		  nycHistoricSites = response;
		  //create an array and fill it with all of the nycHistoricSites
		  for (var i = 0; i < nycHistoricSites.length; i++) {
		    //call the function 
		    createMarker(nycHistoricSites[i]);
		  }
	  }.bind(this));
	}

	//Render the map window
	google.maps.event.addDomListener(window, "load", initialize);

	// global infowindow
	var iw = new google.maps.InfoWindow({
	  maxWidth: 385
	});

	//-------------------------------------------------------
	// function bigImg(x) {
	//    x.style.height = "300px";
	//    //x.style.width = "64px";
	// }

	// function normalImg(x) {
	//    x.style.height = "142px";
	//    //x.style.width = "32px";
	// }
	//-------------------------------------------------------

	function infoWindow(marker, map, location) {

	  google.maps.event.addListener(marker, 'click', function() {
	  	//This was the original code
	    // var html = "<p><b><a href="+location.url+">"+location.name+"</a></b></p>"+"<p>"+location.phone+"</p>"+"<p><a href="+location.image_url+"><img src="+location.image_url+" height='142' ></a></p>"+"<p>"+location.description+"</p>";

	    // //This is the new code with the bigImg and normalImg funtions from above
	    // var html = "<p><b><a href="+location.url+">"+location.name+"</a></b></p>"+"<p>"+location.phone+"</p>"+"<p><img onmouseover=bigImg(this) onmouseout=normalImg(this) border='0' src="+location.image_url" + "alt="location.alt_image_url" + "height='300'></p>"+"<p>" + location.description + "</p>";

	    //This is the new code
	    var html = "<p><b><a href="+location.url+">"+location.name+"</a></b></p>" 	+ "<p>"+location.phone+"</p>" + "<p><img class='enlarge-onhover' src="+location.image_url+" alt="+location.alt_image_url+"></p>" + "<p>"+location.description+"</p>";

	    // set the content (saved in html variable using function closure)
	    if (location.name.includes("Your Location:")) {
	    	var html1 = "<div><h3>" + location.name + "</h3><p>";
	    	iw.setContent(html1);
	    } else {
	    	iw.setContent(html);
	    }
	    // open the infowindow on the marker.
	    iw.open(map, marker);
	  });
	}

	//<img class="enlarge-onhover" src="img.jpg">

	//-------------------------------------------------------
	//+"<p><img src="+location.image_url+" height='142'></p>"+

	//Original code with my info plugged in
	//+"<p><img onmouseover=" + bigImg(this) + " onmouseout=" + normalImg(this) + " border='0' src="location.image_url" + "alt="location.alt_image_url" + "height='600'></p>"+

	//Original code from online
	// <img onmouseover="bigImg(this)" onmouseout="normalImg(this)" border="0" src="smiley.gif" alt="Smiley" width="32" height="32">
	//-------------------------------------------------------
	
</script>

</body>

